<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Kevin W build this air-castle to collect infos &amp; photos"><title>MonoShow | Monologue from kevin</title><link rel="stylesheet" type="text/css" href="css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="favicon.ico"><link rel="apple-touch-icon" href="apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MonoShow</h1><a id="logo" href=".">MonoShow</a><p class="description">Monologue from kevin</p></div><div id="nav-menu"><a class="current" href="."><i class="fa fa-home"> 首页</i></a><a href="archives/"><i class="fa fa-archive"> 归档</i></a><a href="photo/"><i class="fa fa-camera"> photo</i></a><a href="about/"><i class="fa fa-user"> 关于我</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"><a href="2019/03/03/mysql设计规范/">no-title</a></h1><div class="post-meta">2019-03-03</div><div class="post-content"><p>《mysql设计规范》<br>数据结构设计：逻辑设计 –&gt; 物理设计<br>实际工作中：逻辑设计 + 物理设计<br>物理设计：表名，字段名，字段类型<br>磁盘IO和操作系统类型，对mysql的性能是非常大的<br>一. 数据库命名规范<br>所有的数据库对象名称必须使用小写字母并用下划线表示，因为默认情况下，mysql对大小写敏感，mysql数据库本质上是linux系统下的一个文件，而linux系统是大小写敏感的<br>所有数据库对象名称禁止使用mysql保留关键字<br>数据库对象的命名要能做到见名知意，并且最好不要超过32个字符。太长不方便使用，并且会在传输时增加网络开销<br>临时表必须以tmp_为前缀并以日期为后缀<br>备份表必须以bak_为前缀并以日期为后缀<br>所有存储相同数据的列名和列类型必须一致，比如user表中的id和order表中的user_id<br>二. 数据库基本设计规范<br>所有表必须使用Innodb存储引擎<br>极少数特殊业务需求除外<br>Innodb引擎是5.6之后的默认存储引擎；mysql5.5之前使用Myisam(默认存储引擎)<br>Innodb优点：支持事务，行级锁，更好的恢复性，高并发下性能更好<br>数据库和表的字符集统一使用UTF-8<br>如果要存储一些如表情符号的，还需使用UTF-8的拓展字符集<br>数据库，表，字段字符集一定要统一，统一字符集可以避免由于字符集转换产生的乱码<br>在mysql中UTF-8字符集，汉字占3字节，ASCII码占1字节<br>所有表和字段都需要添加注释<br>从一开始就进行数据字典的维护<br>即数据库说明文档<br>尽量控制单表数据量大小，<br>建议控制在500万以内，虽然500万并不是mysql的数据库限制，但是会给修改表结构，备份，恢复带来很大困难。<br>单表可存储数据量大小取决于存储设置和文件系统<br>想减少单表数据量：历史数据归档(常见于日志表)，分库分表(常见于业务表)，分区表<br>建议不要使用mysql分区表，因为分区表在物理上表现为多个文件，在逻辑上表现为一个表。如果一定要分区，请谨慎选择分区键，跨分区查询效率比查询大数据量的单表查询效率更低<br>建议采物理分表的方式管理大数据，但是对应用程序的开发要求和复杂度更高<br>尽量做到冷热数据分离，减少表的宽度(字段数)<br>减少磁盘IO，保证热数据的内存缓存命中率，更有效的利用缓存，避免读入无用的冷数据<br>这样的话，就要对表的列进行拆分，将经常使用的列放到一个表中，可以避免过多的关联操作，也可以提高查询性能<br>禁止在表中建立预留字段<br>预留字段很难做到见名知义，预留字段无法确定存储的数据类型，后期如果修改字段类型，会对全表锁定，严重影响数据库的并发性<br>对目前mysql来说，修改一个字段的成本要远远大于增加一个字段的成本<br>禁止在数据库中存储图片，文件等二级制数据<br>这类数据如果要存，就得使用blog或者text这样的大字段加以存储，会影响数据库的性能<br>文件这种通常所占数据容量很大，会在短时间内造成数据库文件的快速增长，而数据库在读取数据时，会进行大量的随机IO操作，如果数据文件过大，IO操作会非常耗时，从而影响数据库性能<br>正确做法是将这类数据存储在文件服务器中，而数据库只村存储地址信息<br>禁止在线上做数据库压力测试<br>会对正常业务造成影响，也会产生很多垃圾数据<br>建议建立专门的压力测试数据库，进行测试，然后对比测试服务器和线上服务器的硬件环境，评估线上数据库的性能<br>禁止从开发环境，测试环境直连生产环境数据库<br>三. 索引设计规范(Innodb中主键实质上是一个索引)<br>限制每张表上索引数量，建议单表不超过5个索引。索引并不是越多越好，可以提高查询效率，但是会降低插入和更新的效率。甚至在一些情况下，还会降低查询效率，因为mysql优化器在选择如何优化查询时，会根据统计信息，对每一个可用索引来进行评估，以生成一个最好的执行计划，如果同时有很多索引都可以用于查询，就会增加mysql查询优化器生成查询计划的时间。<br>每个Innodb表都必须有一个主键。Innodb是一种索引索引组织表，是指数据存储的逻辑顺序和索引的顺序是相同，Innodb是按照主键索引的顺序来组织表的，因此，每个Innodb表都必须要有一个主键，如果我们没有指定主键，那么Innodb会优先选择表中第一个非空唯一索引来作为主键，如果没有这个索引，那么Innodb会自动生成一个占6字节的主键，而这个主键的性能并不是最好。<br>不使用更新频繁的列作为主键，不使用多列联合主键。因为Innodb是一种索引索引组织表，如果主键上的值频繁更新，就意味着数据存储的逻辑顺序频繁变动，必然会带来大量的IO操作，降低数据库性能。<br>不要使用uuid，md5，hash，字符串列作为主键。因为这种主键不能保证主键的值是顺序增长的，如果后来的主键值在已有主键值的中间段，那么这个主键插入的时候，会将所有主键值大于它的列都向后移。<br>最好选择能保证值的顺序为顺序增长的列为主键。并且数据不能重复，建议用mysql自增id建立主键<br>面试问题1: 要在哪些列上建立索引?<br>在select，delete，update的where从句中的列<br>包含在order by，group by，distinct字段中的列<br>多表join的关联列：mysql对关联操作的处理方式只有一种，那就是嵌套循环的关联方式，所以这种操作的性能对关联列上的索引的依赖性很大<br>面试问题2: 复合索引，如何选择索引列的顺序?<br>从左到右的顺序来使用的<br>区分度(列中group by的数目和此列总行数的比值趋近于1)最高的列放在联合索引的最左侧<br>在区分度差不多的情况下，尽量吧字段长度小的放在联合索引的最左侧，因为同样的行数，字段小的文件也小，读取时IO性能更优<br>使用最频繁的列放在联合索引的左侧，这样的话，可以较少地建立索引就能满足需求<br>避免建立冗余索引和重复索引<br>对于频繁的查询优先使用覆盖索引<br>就是包含了所有查询字段的索引，这样可以避免Innodb表进行索引的二次查找，并可以把随机IO变为顺序IO提高查询效率<br>尽量避免使用外键<br>mysql和别的数据库不同，会自动在外键上建立索引，会降低数据库的写性能<br>建议不使用外键约束，但是一定要在表与表之间的关联键上建立索引，虽然外键是为了保证数据的完整性，但是最好在代码中去保证。<br>四. 字段设计规范<br>优先选择符合存储需要的最小的数据类型<br>尽量将字符串转化为数字类型存储：如将ip存储为数字：inet_aton(‘255.255.255.255’) = 4294967295 ,反之， inet_ntoa(4294967295) = ‘255.255.255.255’<br>对于非负整型数据，优先使用无符号整型来存储，如：id,age,无符号相对于有符号，可以多出一倍的存储空间<br>mysql中，varchar(n)中n表示字符数而不是字节数<br>避免使用text，blog来存储字段，这种类型只能使用前缀索引，如果非要使用，建议将这种数据分离到单独的拓展表中<br>避免使用enum类型。枚举本身是一个字符串类型，但是内部确是用正数类型来存储的，所以最多可存储65535种不同的值，修改的话必须使用alter语句，直接修改元数据，有操作风险；order by效率低，必须转换并无法使用索引，禁止使用数值作为enum值，因为enum本身是索引顺序存储的，会造成逻辑混淆<br>尽可能把所有列定义为not null。<br>索引null列需要额外的空间来保存，占更多空间<br>进行比较和计算时，对null值作特别的处理，可能造成索引失效<br>禁止使用字符串来存储日期型数据。<br>无法使用日期函数计算比较<br>字符串存储要占更多的内存空间，datetime(8字节)和timestamp(本身是以int存储，占4字节,范围:1970-01-01 00:00:01到2038-01-19 03:14:07)<br>财务相关数据，使用decimal类型 (精准浮点类型，在计算时不丢失精度)。<br>五. SQL开发规范<br>建议使用预编译语句(prepareStatment)进行数据库操作<br>可以同步执行预编译计划，减少预编译时间<br>可以有效避免动态sql带来的SQL注入的问题<br>只传参数，一次解析，多次使用，比传递sql语句更高效<br>避免数据类型的隐式转换<br>一般出现在where从句中，会导致索引失效，如：select id,name from user where id = ‘12’;<br>充分利用已存在的索引<br>避免使用双%的查询条件，不走索引<br>一个SQL只能利用到复合索引中的一列进行范围查询<br>使用left join或not exists来优化not in操作<br>程序连接不同的数据库使用不同的账号，禁止跨库查询<br>为数据库迁移和分库分表留出余地<br>降低业务耦合度<br>避免权限过大而产生的安全风险<br>禁止使用select * 来查询，必须用字段名<br>可能会消耗更多的cpu和IO以及网络资源<br>无法使用覆盖索引<br>可以减少表结构变更对已有程序的影响<br>禁止使用不含字段列表的insert语句。<br>可以减少表结构变更对已有程序的影响<br>禁止使用子查询<br>虽然可使sql可读性好，但是缺点远远大于优点<br>子查询返回的结果集无法使用索引，结果集会被存储到一个临时表中，结果集越大性能越低<br>把子查询优化为join操作，但是并不是所有的都可以优化为join，一般情况下，只有当子查询是在in字句中，并且子查询是一个简单的sql(不包含union，group by，order by，limit)才能转换为关联查询<br>避免join过多的表<br>每join一个表会占一部分内存(join_buffer_size)<br>会产生临时表操作，影响查询效率<br>mysql最多允许关联61个表，建议不超过5个<br>减少同数据库的交互次数<br>数据库更适合处理批量操作<br>合并多个相同的操作到一起，提高处理效率<br>使用in代替or<br>in的值不要超过500个<br>in 操作可以有效利用索引<br>禁止使用order by rand()进行随机排序<br>会把表中所有符合条件的数据装载到内存中进行排序<br>会消耗大量的cpu和io及内存资源<br>推荐在程序中获取随机值<br>禁止在where从句中对列进行函数转换和计算<br>导致无法使用相关列上的索引<br>where date(create_time)=’20170901’ 写成 where create_time &gt;= ‘20170901’ and create_time &lt; ‘20170902’<br>在明显不会有重复值时使用union all而不是union<br>union 会把所有数据放在临时表中后再进行去重操作，会多消耗内存，IO，网络资源<br>union all 不会再对结果集进行去重操作<br>拆分复杂的大sql为多个小sql<br>目前mysql中一个sql只能使用一个cpu计算，不支持多cpu并行计算<br>sql拆分后可以通过并行执行来提高处理效率<br>六. 数据库操作行为规范<br>主要面向手动操作数据库的行为<br>超过100万的批量写操作，要分批多次进行操作<br>主从复制中：大批量操作可能会造成严重的主从延迟，因为当主库执行完成后，才会在从库执行<br>binlog日志为row格式时会产生大量的日志<br>避免产生大量事务，产生阻塞，占满可用连接<br>对大表数据结构的修改一定要谨慎<br>可能会造成严重的锁表操作，尤其是生产环境，是不能忍受的<br>对于大表使用pt-online-schema-change修改表结构：<br>首先会建立一个与原表结构相同的新表<br>然后在新表上进行表结构的修改<br>然后把原表中的数据复制到新表中，并且增加一些触发器，以便把原表中即时新增的数据也复制到新表中<br>在行的所有数据复制完成之后，会在原表上增加一个很准的时间锁，同时把新表命名为原表，把原表删掉<br>[实际上是把一个原子的DDL操作分解成多批次进行]<br>[避免大表修改产生的主从延迟问题]<br>[避免在对表字段进行修改时进行锁表]<br>禁止为程序使用的账号赋予super权限<br>当数据库连接数达到最大限制时，允许1个有super权限的用户连接<br>super权限只能留给DBA处理问题的账号使用<br>对于程序连接数据库账号，遵循权限最小原则<br>程序使用的数据库账号只能在一个DB下使用，不准跨库</p></div><p class="readmore"><a href="2019/03/03/mysql设计规范/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="2019/03/03/php-notes3/">PHP &amp; MySQL learning notes (4)</a></h1><div class="post-meta">2019-03-03</div><div class="post-content"><p>由于PHP和MySQL版本问题，对 <a href="https://hyqskevin.github.io/2018/10/28/w3school-php/#3-mySQL">PHP &amp; MySQL learning notes (1)</a> 中曾经写过用的PHP操作MySQL数据库进行笔记更新<br>完善 <a href="https://hyqskevin.github.io/2019/01/21/php-notes2/#MySQL">PHP &amp; MySQL learning notes (3)</a> 中的代码<br>重新用 MySQLi (面向对象) MySQLi (面向过程) PDO 三种方式演示PHP操作MySQL<br></p></div><p class="readmore"><a href="2019/03/03/php-notes3/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="2019/03/03/mysql-function/">mysql_function</a></h1><div class="post-meta">2019-03-03</div><p class="readmore"><a href="2019/03/03/mysql-function/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="2019/02/27/migration/">Laravel SQL migration</a></h1><div class="post-meta">2019-02-27</div><div class="post-content"><p>结合Laravel的Schema构建器构建应用的数据库表结构，类似于数据库的版本控制，允许团队成员间编辑并共享应用的数据库表结构<br>Laravel 的 Schema 门面提供了与数据库系统无关的创建和操纵表的支持，在 Laravel 所支持的所有数据库系统中提供一致的、优雅的、流式的 API，将SQL转成PHP去执行</p>
<p>部署环境(WAMP)<br>php 7.3.1<br>composer 1.8.4<br>laravel 5.8.0<br>MySQL 5.7.24<br></p></div><p class="readmore"><a href="2019/02/27/migration/">阅读全文</a></p></div><div class="post"><h1 class="post-title"><a href="2019/02/23/mysql-regular/">mysql like子句和正则表达式匹配</a></h1><div class="post-meta">2019-02-23</div><div class="post-content"><p>-基础笔记-<br>MySQL like子句和正则表达式的使用<br>MySQL可以通过 LIKE …% 来进行模糊匹配，也可以使用 <code>REGEXP</code> 操作符来进行正则表达式匹配<br></p></div><p class="readmore"><a href="2019/02/23/mysql-regular/">阅读全文</a></p></div><nav class="page-navigator"><span class="page-number current">1</span><a class="page-number" href="page/2/">2</a><a class="page-number" href="page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="page/5/">5</a><a class="extend next" rel="next" href="page/2/">下一页</a></nav></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="categories/Adobe/">Adobe</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="categories/notes/">notes</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="categories/others/">others</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="categories/practice/">practice</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="categories/repo/">repo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="categories/study/">study</a><span class="category-list-count">11</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="tags/bootstrap2-0/" style="font-size: 15px;">bootstrap2.0</a> <a href="tags/others/" style="font-size: 15px;">others</a> <a href="tags/Kaggle/" style="font-size: 15px;">Kaggle</a> <a href="tags/hexo/" style="font-size: 15px;">hexo</a> <a href="tags/time-series/" style="font-size: 15px;">time_series</a> <a href="tags/ensemble-learning/" style="font-size: 15px;">ensemble_learning</a> <a href="tags/bp-nn/" style="font-size: 15px;">bp_nn</a> <a href="tags/book/" style="font-size: 15px;">book</a> <a href="tags/php/" style="font-size: 15px;">php</a> <a href="tags/mysql/" style="font-size: 15px;">mysql</a> <a href="tags/slam/" style="font-size: 15px;">slam</a> <a href="tags/Linux-device/" style="font-size: 15px;">Linux_device</a> <a href="tags/laravel/" style="font-size: 15px;">laravel</a> <a href="tags/machine-learning/" style="font-size: 15px;">machine_learning</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="2019/03/03/mysql设计规范/">mysql设计规范</a></li><li class="post-list-item"><a class="post-list-link" href="2019/03/03/php-notes3/">PHP & MySQL learning notes (4)</a></li><li class="post-list-item"><a class="post-list-link" href="2019/03/03/mysql-function/">mysql_function</a></li><li class="post-list-item"><a class="post-list-link" href="2019/02/27/migration/">Laravel SQL migration</a></li><li class="post-list-item"><a class="post-list-link" href="2019/02/23/mysql-regular/">mysql like子句和正则表达式匹配</a></li><li class="post-list-item"><a class="post-list-link" href="2019/02/20/fund-flow/">fund_flow</a></li><li class="post-list-item"><a class="post-list-link" href="2019/02/16/book-list/">book-list</a></li><li class="post-list-item"><a class="post-list-link" href="2019/02/15/mysql/">mysql 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="2019/02/14/move-to-windows/">move to windows</a></li><li class="post-list-item"><a class="post-list-link" href="2019/01/21/php-notes2/">PHP & MySQL learning notes (3)</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="." rel="nofollow">MonoShow.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zindex="-2" count="50" src="//lib.baomitu.com/canvas-nest.js/2.0.3/canvas-nest.umd.js"></script><script type="text/javascript" src="js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":true},"log":false});</script></body></html>