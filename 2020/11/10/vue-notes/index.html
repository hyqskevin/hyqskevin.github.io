<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Kevin W build this air-castle to collect infos &amp; photos"><title>Vue功能实现和使用技巧 | MonoShow</title><link rel="stylesheet" type="text/css" href="../../../../css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="../../../../favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="../../../../favicon.ico"><link rel="apple-touch-icon" href="../../../../apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="../../../../apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="../../../../atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Vue功能实现和使用技巧</h1><a id="logo" href="../../../../.">MonoShow</a><p class="description">Monologue from Kevin_W</p></div><div id="nav-menu"><a class="current" href="../../../../."><i class="fa fa-home"> 时间线</i></a><a href="../../../../archives/"><i class="fa fa-archive"> 档案袋</i></a><a href="../../../../categories/language-learning/"><i class="fa fa-book"> 看原著了嘛</i></a><a href="../../../../categories/code/"><i class="fa fa-github"> 码代码了嘛</i></a><a href="../../../../categories/paper/"><i class="fa fa-file-text"> 翻译论文了嘛</i></a><a href="../../../../photo/"><i class="fa fa-camera"> Ins摄影集</i></a><a href="../../../../about/"><i class="fa fa-user"> 我是谁我在哪</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Vue功能实现和使用技巧</h1><div class="post-meta">Nov 10, 2020<span> | </span><span class="category"><a href="../../../../categories/study/">study</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 2.3k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 10</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Vue-动态组件使用"><span class="toc-number">1.</span> <span class="toc-text">Vue 动态组件使用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#动态路由匹配"><span class="toc-number">2.</span> <span class="toc-text">动态路由匹配</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#页面跳转和导航"><span class="toc-number">3.</span> <span class="toc-text">页面跳转和导航</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#定义链接实现声明式导航"><span class="toc-number">3.1.</span> <span class="toc-text"> 定义链接实现声明式导航</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#router-实例实现编程式导航"><span class="toc-number">3.2.</span> <span class="toc-text">router 实例实现编程式导航</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#keep-alive-网页性能优化"><span class="toc-number">4.</span> <span class="toc-text">keep-alive 网页性能优化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vuex-数据防刷新丢失"><span class="toc-number">5.</span> <span class="toc-text">Vuex 数据防刷新丢失</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义指令避免误触和多次点击"><span class="toc-number">6.</span> <span class="toc-text">自定义指令避免误触和多次点击</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#制作可复用组件"><span class="toc-number">7.</span> <span class="toc-text">制作可复用组件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#上传文件功能"><span class="toc-number">8.</span> <span class="toc-text">上传文件功能</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Vuex-监听状态变更"><span class="toc-number">9.</span> <span class="toc-text">Vuex 监听状态变更</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#表单设置日期限制"><span class="toc-number">9.1.</span> <span class="toc-text">表单设置日期限制</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#表单身份证校验"><span class="toc-number">9.2.</span> <span class="toc-text">表单身份证校验</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#其它注意事项"><span class="toc-number">10.</span> <span class="toc-text">其它注意事项</span></a></li></ol></div></div><div class="post-content"><p>汇总记录前端开发时，使用 Vue 框架遇到的功能实现和开发技巧。</p>
<a id="more"></a>
<h2 id="Vue-动态组件使用"><a href="#Vue-动态组件使用" class="headerlink" title="Vue 动态组件使用"></a>Vue 动态组件使用</h2><p>动态组件功能用于在不同组件之间进行动态切换，可以通过 Vue 的 <code>&lt;component&gt;</code> 元素加一个特殊的 is attribute 来实现</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// `currentComponent` 改变时显示的组件同时改变</span></span><br><span class="line">&lt;component :is=<span class="string">"currentComponent"</span>&gt;<span class="xml"><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span></span><br><span class="line">&lt;button @click=<span class="string">"(currentComponent === 'A') ? 'B':'A'"</span>&gt;Switch&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">/</span><span class="regexp">/引入组件A以及组件B</span></span><br><span class="line"><span class="regexp">import A from "./</span>a<span class="string">"</span></span><br><span class="line"><span class="string">import B from "</span>./b<span class="string">"</span></span><br><span class="line"><span class="string">export default &#123;</span></span><br><span class="line"><span class="string">  components: &#123;A, B&#125;,</span></span><br><span class="line"><span class="string">  data () &#123;</span></span><br><span class="line"><span class="string">    return &#123;</span></span><br><span class="line"><span class="string">      //默认显示组件A，若字符串为B则显示组件B,name为component声明</span></span><br><span class="line"><span class="string">      currentComponent: 'A'</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&lt;/script&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>v-show，v-if，:is 之间的区别</li>
</ul>
<p><code>v-show</code> 会同时加载两个组件，两个组件的生命周期都会触发，会造成不必要的性能浪费，而且切换的时候不会再创造挂载一次，无法重新渲染。<br><code>v-if</code> 不会造成同时加载两个组件，但 v-if 每次切换都会创造挂载一次，如果没有重新渲染的需要，会造成性能浪费。<br><code>:is</code> 可以通过 keep-alive 标签缓存，被该标签包裹的组件会被缓存下来，每次点击都不会重新渲染，避免了重渲染导致的性能问题。<code>include</code> 和 <code>exclude</code> 属性也允许组件有条件地缓存。二者都可以用逗号分隔字符串、正则表达式或一个数组来表示。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 逗号分隔字符串 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">include</span>=<span class="string">"a,b"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">"currentComponent"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 正则表达式 (使用 v-bind) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">"/a|b/"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">"currentComponent"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- Array (use v-bind) --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span> <span class="attr">:include</span>=<span class="string">"['a', 'b']"</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">component</span> <span class="attr">:is</span>=<span class="string">"currentComponent"</span>&gt;</span><span class="tag">&lt;/<span class="name">component</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="动态路由匹配"><a href="#动态路由匹配" class="headerlink" title="动态路由匹配"></a>动态路由匹配</h2><p>动态路由用于把某种模式匹配到的所有路由，全都映射到同个组件，可以在 vue-router 的路由路径中使用“动态路径参数”(dynamic segment) 来达到这个效果。一个“路径参数”使用冒号 : 标记。当匹配到一个路由时，参数值会被设置到 <code>this.$route.params</code>，可以在每个组件内使用。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">	routes: [</span><br><span class="line">		<span class="comment">// 动态路径参数 以冒号开头</span></span><br><span class="line">		&#123; <span class="attr">path</span>: <span class="string">'/user/:id'</span>, <span class="attr">component</span>: User &#125;,</span><br><span class="line">	],</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="页面跳转和导航"><a href="#页面跳转和导航" class="headerlink" title="页面跳转和导航"></a>页面跳转和导航</h2><h3 id="定义链接实现声明式导航"><a href="#定义链接实现声明式导航" class="headerlink" title=" 定义链接实现声明式导航"></a><router-link> 定义链接实现声明式导航</router-link></h3><p><code>&lt;router-link :to=&quot;...&quot;&gt;</code> 内部调用 <code>router.push</code> 方法实现页面导航</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"&#123;name: 'detail', params: &#123;name: 1&#125;&#125;"</span>&gt;</span> xxx <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">router-link</span> <span class="attr">:to</span>=<span class="string">"&#123;name: 'detail', query: &#123;id: 1&#125;&#125;"</span>&gt;</span> xxx <span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>可以使用 <code>this.$route.params</code> 或 <code>this.$route.params</code> 获取路由参数。</li>
</ul>
<h3 id="router-实例实现编程式导航"><a href="#router-实例实现编程式导航" class="headerlink" title="router 实例实现编程式导航"></a>router 实例实现编程式导航</h3><p>在 Vue 实例内部，可以通过 <code>$router</code> 访问路由实例，可以调用 <code>this.$router.push</code> 方法，向 history 栈添加一个新的记录，点击浏览器后退按钮时也可以回到之前的 URL。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 字符串</span></span><br><span class="line">router.push(<span class="string">'home'</span>)</span><br><span class="line"><span class="comment">// 对象</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">'home'</span> &#125;)</span><br><span class="line"><span class="comment">// 命名的路由/user/123</span></span><br><span class="line">router.push(&#123; <span class="attr">name</span>: <span class="string">'user'</span>, <span class="attr">params</span>: &#123; <span class="attr">uid</span>: <span class="string">'123'</span> &#125; &#125;) <span class="comment">// 刷新后参数会被清空</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">`/user/<span class="subst">$&#123;userId&#125;</span>`</span> &#125;) <span class="comment">// 刷新后参数不会被清空</span></span><br><span class="line"><span class="comment">// 带查询参数，/home?uid=123</span></span><br><span class="line">router.push(&#123; <span class="attr">path</span>: <span class="string">'home'</span>, <span class="attr">query</span>: &#123; <span class="attr">uid</span>: <span class="string">'123'</span> &#125; &#125;) <span class="comment">// 刷新后不会被清空</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>router.replace(&#39;&#39;)</code> 跳转页面会替换掉原有的 history 记录</li>
<li><code>router.go(n)</code> 在 history 记录中前进或后退多少步</li>
</ul>
<h2 id="keep-alive-网页性能优化"><a href="#keep-alive-网页性能优化" class="headerlink" title="keep-alive 网页性能优化"></a>keep-alive 网页性能优化</h2><p>keep-alive 主要用于保留组件状态或避免重新渲染 DOM 导致性能降低，通常都会在 <code>app.vue</code> 的 <code>&lt;router-view/&gt;</code> 外面加一层 <code>&lt;keep-alive&gt;</code></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">keep-alive</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">router-view</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">keep-alive</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>这样做也会导致一些问题，当组件的值更新后组件没有被重新渲染，做到动态显示需要使用额外生命周期函数 <code>activated</code><br>进入页面会执行 mounted 和 activated，当修改值后再次进入首页不会再执行 mounted 触发新的数据请求，但是 activated 会继续执行。可以在 activated 函数中判断新数据和前一次显示是否相同，如果不同再次触发 ajax 数据请求。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">mounted () &#123;</span><br><span class="line">   <span class="keyword">this</span>.lastData = <span class="keyword">this</span>.data;</span><br><span class="line">   <span class="keyword">this</span>.getNewData();</span><br><span class="line">&#125;</span><br><span class="line">activated () &#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">this</span>.lastData !== <span class="keyword">this</span>.data) &#123;</span><br><span class="line">      <span class="keyword">this</span>.lastData = <span class="keyword">this</span>.data;</span><br><span class="line">      <span class="keyword">this</span>.getNewData();</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在路由更新后页面由于 keep-alive 的缓存不会执行 mounted 触发刷新，需要设置路由的 key 值，在每次进入页面时比较路由名称，若不相同则刷新页面。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">/*App.vue*/</span></span><br><span class="line">&lt;keep-alive&gt;</span><br><span class="line">   &lt;router-view :key=<span class="string">"key"</span> /&gt;</span><br><span class="line">&lt;<span class="regexp">/keep-alive&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  name: 'App',</span></span><br><span class="line"><span class="regexp">  computed: &#123;</span></span><br><span class="line"><span class="regexp">    key () &#123;</span></span><br><span class="line"><span class="regexp">      return this.$route.name !== undefined</span></span><br><span class="line"><span class="regexp">        ? this.$route.name + +new Date()</span></span><br><span class="line"><span class="regexp">        : this.$route + +new Date()</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>
<h2 id="Vuex-数据防刷新丢失"><a href="#Vuex-数据防刷新丢失" class="headerlink" title="Vuex 数据防刷新丢失"></a>Vuex 数据防刷新丢失</h2><p>引入 vuex-persist 插件将状态保存至 cookie 或者 localStorage 中，刷新后数据不丢失。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> VuexPersistence <span class="keyword">from</span> <span class="string">'vuex-persist'</span></span><br><span class="line"><span class="keyword">const</span> vuexLocal = <span class="keyword">new</span> VuexPersistence(&#123;</span><br><span class="line">	storage: <span class="built_in">window</span>.localStorage,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">const</span> store = <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123; ... &#125;,</span><br><span class="line">  mutations: &#123; ... &#125;,</span><br><span class="line">  actions: &#123; ... &#125;,</span><br><span class="line">  plugins: [vuexLocal.plugin]</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="自定义指令避免误触和多次点击"><a href="#自定义指令避免误触和多次点击" class="headerlink" title="自定义指令避免误触和多次点击"></a>自定义指令避免误触和多次点击</h2><p>使用 Vue.directive 自定义防误触指令</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">'vue'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> preventReClick = Vue.directive(<span class="string">'preventReClick'</span>, &#123;</span><br><span class="line">	inserted: <span class="function"><span class="keyword">function</span> (<span class="params">el, binding</span>) </span>&#123;</span><br><span class="line">		<span class="comment">// 增加监听事件</span></span><br><span class="line">		el.addEventListener(<span class="string">'click'</span>, () =&gt; &#123;</span><br><span class="line">			<span class="keyword">if</span> (!el.disabled) &#123;</span><br><span class="line">				el.disabled = <span class="literal">true</span></span><br><span class="line">				setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">					el.disabled = <span class="literal">false</span></span><br><span class="line">				&#125;, binding.value || <span class="number">3000</span>)</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;)</span><br><span class="line">	&#125;,</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123; preventReClick &#125;</span><br></pre></td></tr></table></figure>
<h2 id="制作可复用组件"><a href="#制作可复用组件" class="headerlink" title="制作可复用组件"></a>制作可复用组件</h2><p>复用组件需要在样式和功能上做到继承和迭代，是在系统整体设计时抽象出的组件，多为布局组件，不涉及详细的功能实现。组件需要做到高内聚低耦合，组件内独立交互，功能受控于组件本身。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 按钮组件抽象，样式设置为外部继承 cname，和内部自定义 button，留出按钮名称 title 和 &lt;slot&gt; 插槽作为具体内容的补充空间</span></span><br><span class="line">&lt;div :<span class="class"><span class="keyword">class</span></span>=<span class="string">"[button, cname]"</span>&gt;</span><br><span class="line">  &lt;div&gt;&#123;&#123; title &#125;&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  &lt;slot /</span>&gt;</span><br><span class="line">&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp"></span></span><br><span class="line"><span class="regexp">&lt;script&gt;</span></span><br><span class="line"><span class="regexp">export default &#123;</span></span><br><span class="line"><span class="regexp">  name: 'BigBtn',</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 通过 props 传入外部参数</span></span><br><span class="line"><span class="regexp">  props: &#123;</span></span><br><span class="line"><span class="regexp">    cname: &#123;</span></span><br><span class="line"><span class="regexp">      type: String,</span></span><br><span class="line"><span class="regexp">      default: ''</span></span><br><span class="line"><span class="regexp">    &#125;,</span></span><br><span class="line"><span class="regexp">    title: &#123;</span></span><br><span class="line"><span class="regexp">      type: String,</span></span><br><span class="line"><span class="regexp">      default: 'title'</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;,</span></span><br><span class="line"><span class="regexp">  /</span><span class="regexp">/ 设置内部定义的样式</span></span><br><span class="line"><span class="regexp">  data () &#123;</span></span><br><span class="line"><span class="regexp">    return &#123;</span></span><br><span class="line"><span class="regexp">      button: 'button'</span></span><br><span class="line"><span class="regexp">    &#125;</span></span><br><span class="line"><span class="regexp">  &#125;</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">&lt;/</span>script&gt;</span><br><span class="line"></span><br><span class="line">&lt;style lang=<span class="string">"stylus"</span>&gt;</span><br><span class="line"><span class="comment">// 引入样式</span></span><br><span class="line">@<span class="keyword">import</span> <span class="string">"~@/styles/button.styl"</span></span><br><span class="line">.button</span><br><span class="line">  bigBtn() <span class="comment">// 默认样式</span></span><br><span class="line">.blueBtn</span><br><span class="line">  bigBtn($btnColor: $btnBlue) <span class="comment">// cname 传入 blueBtn 设置颜色为蓝色</span></span><br><span class="line">.greenBtn</span><br><span class="line">  bigBtn($btnColor: $btnGreen) <span class="comment">// cname 传入 greenBtn 设置颜色为绿色</span></span><br><span class="line">&lt;<span class="regexp">/style&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="上传文件功能"><a href="#上传文件功能" class="headerlink" title="上传文件功能"></a>上传文件功能</h2><p>使用 element-ui 的 upload 功能实现图片展示，上传和读取，on-change 触发文件状态改变时的钩子，调用上传照片 api 将照片数据传递到后台；on-preview 用于显示已上传的图片的缩略图；传递多个文件时文件列表存储在 file-list 中。</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">el-upload</span></span></span><br><span class="line"><span class="tag">	<span class="attr">action</span>=<span class="string">"actionUrl"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">list-type</span>=<span class="string">"picture-card"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">ref</span>=<span class="string">"upload"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">:file-list</span>=<span class="string">"fileList"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">:auto-upload</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">:on-change</span>=<span class="string">"getFile"</span></span></span><br><span class="line"><span class="tag">	<span class="attr">:on-preview</span>=<span class="string">"handlePictureCardPreview"</span></span></span><br><span class="line"><span class="tag">&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">slot</span>=<span class="string">"tip"</span> <span class="attr">class</span>=<span class="string">"el-upload__tip"</span>&gt;</span>上传一张jpg/png文件<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">el-icon</span> <span class="attr">class</span>=<span class="string">"el-icon-plus"</span>&gt;</span><span class="tag">&lt;/<span class="name">el-icon</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">el-upload</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 获取文件信息</span></span><br><span class="line">getFile (file) &#123;</span><br><span class="line">  <span class="keyword">let</span> uid = <span class="keyword">this</span>.$store.state.currentUid</span><br><span class="line">  <span class="comment">// 调用上传照片的api</span></span><br><span class="line">  api._updImage(uid, <span class="keyword">this</span>.aid, res).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>若上传 base64 位图片需要进行转码之后调用 api 上传：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 图片转base64</span></span><br><span class="line">getBase64 (file) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> reader = <span class="keyword">new</span> FileReader()</span><br><span class="line">    <span class="keyword">let</span> imgResult = <span class="string">''</span></span><br><span class="line">    reader.readAsDataURL(file)</span><br><span class="line">    reader.onload = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      imgResult = reader.result</span><br><span class="line">    &#125;</span><br><span class="line">    reader.onerror = <span class="function"><span class="keyword">function</span> (<span class="params">error</span>) </span>&#123;</span><br><span class="line">      reject(error)</span><br><span class="line">    &#125;</span><br><span class="line">    reader.onloadend = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      resolve(imgResult)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Vuex-监听状态变更"><a href="#Vuex-监听状态变更" class="headerlink" title="Vuex 监听状态变更"></a>Vuex 监听状态变更</h2><p>Vuex 允许我们在 store 中定义“getter”（可以认为是 store 的计算属性）。就像计算属性一样，getter 的返回值会根据它的依赖被缓存起来，且只有当它的依赖值发生了改变才会被重新计算。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">state: &#123;</span><br><span class="line">  updFlag: <span class="literal">false</span></span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 添加计算属性，依赖值改变时重新计算</span></span><br><span class="line">getters: &#123;</span><br><span class="line">  updFlag: <span class="function"><span class="params">state</span> =&gt;</span> state.updFlag</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// 执行状态变更</span></span><br><span class="line">mutations: &#123;</span><br><span class="line">  updateFlag (state, update) &#123;</span><br><span class="line">    state.updFlag = update</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="表单设置日期限制"><a href="#表单设置日期限制" class="headerlink" title="表单设置日期限制"></a>表单设置日期限制</h3><h3 id="表单身份证校验"><a href="#表单身份证校验" class="headerlink" title="表单身份证校验"></a>表单身份证校验</h3><h2 id="其它注意事项"><a href="#其它注意事项" class="headerlink" title="其它注意事项"></a>其它注意事项</h2><ol>
<li><p>监听组件原生事件<br><code>@click.native=</code>可以在子组件监听根元素的原生事件，不需要通过<code>$emit</code>事件</p>
</li>
<li><p>ref 属性<br>给 DOM 元素或子组件注册引用信息，引用信息将会注册在父组件的 <code>$refs</code> 对象上，如果在普通的 DOM 元素上使用，引用指向的就是 DOM 元素；如果用在子组件上，引用就指向组件实例。<br>通过<code>this.$refs.ref</code>访问 dom 节点或组件实例(data)</p>
</li>
<li><p>回到顶部功能<br>使用 element-ui 中提供的功能实现：</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&lt;el-backtop</span><br><span class="line">	target=<span class="string">".page-component__scroll .el-scrollbar__wrap"</span></span><br><span class="line">	visibility-height=<span class="string">"200"</span></span><br><span class="line">	right=<span class="string">"30"</span></span><br><span class="line">	bottom=<span class="string">"30"</span></span><br><span class="line">&gt;</span><br><span class="line">	up</span><br><span class="line">&lt;<span class="regexp">/el-backtop&gt;</span></span><br></pre></td></tr></table></figure>
<p>也可以使用 better-scroll 插件实现，通过监听下拉时 y 轴的移动距离显示上拉按钮，点击后触发返回顶部事件。</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 回到开头</span></span><br><span class="line">toTop () &#123;</span><br><span class="line">  <span class="keyword">if</span> (<span class="keyword">this</span>.toTop) &#123;</span><br><span class="line">    <span class="comment">// 延迟20ms后在1s内回到顶部</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">this</span>.scrollTo(<span class="number">0</span>, <span class="number">0</span>, <span class="number">1000</span>)</span><br><span class="line">    &#125;, <span class="number">20</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p><code>render: h =&gt; h(App)</code><br>h 作为 createElement 的别名是 Vue 生态系统中的一个通用惯例。它来自单词 <code>hyperscript</code>，这个单词通常用在 virtual-dom 的实现中。hyperscript 本身指生成 HTML 结构的 script 脚本。 — Even You</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">render: <span class="function"><span class="keyword">function</span> (<span class="params">createElement</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> createElement(App);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// h &lt;- createElement</span></span><br><span class="line">render: <span class="function"><span class="keyword">function</span> (<span class="params">h</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> h(App);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ES6</span></span><br><span class="line">render: <span class="function"><span class="params">h</span> =&gt;</span> h(App)</span><br></pre></td></tr></table></figure>
</li>
</ol>
<hr>
<p>参考资料：<br><a href="https://router.vuejs.org/zh/guide/essentials/navigation.html" target="_blank" rel="noopener">https://router.vuejs.org/zh/guide/essentials/navigation.html</a><br><a href="https://vuex.vuejs.org/zh/" target="_blank" rel="noopener">https://vuex.vuejs.org/zh/</a><br><a href="https://better-scroll.github.io/docs/zh-CN/" target="_blank" rel="noopener">https://better-scroll.github.io/docs/zh-CN/</a><br><a href="https://element.faas.ele.me/#/zh-CN/" target="_blank" rel="noopener">https://element.faas.ele.me/#/zh-CN/</a></p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>KevinW</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/11/10/vue-notes/">https://hyqskevin.github.io/2020/11/10/vue-notes/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！</li></ul></div><br><div class="tags"><a href="../../../../tags/Vue/">Vue</a></div><div class="post-nav"><a class="pre" href="../../26/EDH-combo/">Temer EDH combo</a><a class="next" href="../../../05/28/better-scroll/">BetterScroll插件实现页面滚动效果</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 学习分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/code/">code</a><span class="category-list-count">8</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/language-learning/">language-learning</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/note/">note</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/notes/">notes</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/paper/">paper</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/repo/">repo</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/study/">study</a><span class="category-list-count">26</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="../../../../tags/others/" style="font-size: 15px;">others</a> <a href="../../../../tags/MTG/" style="font-size: 15px;">MTG</a> <a href="../../../../tags/algorithm/" style="font-size: 15px;">algorithm</a> <a href="../../../../tags/Vue/" style="font-size: 15px;">Vue</a> <a href="../../../../tags/book/" style="font-size: 15px;">book</a> <a href="../../../../tags/boosting/" style="font-size: 15px;">boosting</a> <a href="../../../../tags/Kaggle/" style="font-size: 15px;">Kaggle</a> <a href="../../../../tags/c/" style="font-size: 15px;">c++</a> <a href="../../../../tags/sklearn/" style="font-size: 15px;">sklearn</a> <a href="../../../../tags/flask/" style="font-size: 15px;">flask</a> <a href="../../../../tags/time-series/" style="font-size: 15px;">time_series</a> <a href="../../../../tags/ensemble-learning/" style="font-size: 15px;">ensemble_learning</a> <a href="../../../../tags/bp-nn/" style="font-size: 15px;">bp_nn</a> <a href="../../../../tags/hexo/" style="font-size: 15px;">hexo</a> <a href="../../../../tags/JavaScript/" style="font-size: 15px;">JavaScript</a> <a href="../../../../tags/laravel/" style="font-size: 15px;">laravel</a> <a href="../../../../tags/python/" style="font-size: 15px;">python</a> <a href="../../../../tags/bootstrap2-0/" style="font-size: 15px;">bootstrap2.0</a> <a href="../../../../tags/php/" style="font-size: 15px;">php</a> <a href="../../../../tags/machine-learning/" style="font-size: 15px;">machine_learning</a> <a href="../../../../tags/mysql/" style="font-size: 15px;">mysql</a> <a href="../../../../tags/pandas/" style="font-size: 15px;">pandas</a> <a href="../../../../tags/slam/" style="font-size: 15px;">slam</a> <a href="../../../../tags/session/" style="font-size: 15px;">session</a> <a href="../../../../tags/cookie/" style="font-size: 15px;">cookie</a> <a href="../../../../tags/Linux-device/" style="font-size: 15px;">Linux_device</a> <a href="../../../../tags/log/" style="font-size: 15px;">log</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="../../26/EDH-combo/">Temer EDH combo</a></li><li class="post-list-item"><a class="post-list-link" href>Vue功能实现和使用技巧</a></li><li class="post-list-item"><a class="post-list-link" href="../../../05/28/better-scroll/">BetterScroll插件实现页面滚动效果</a></li><li class="post-list-item"><a class="post-list-link" href="../../../05/12/swiper/">swiper滑动插件</a></li><li class="post-list-item"><a class="post-list-link" href="../../../05/10/js同步和异步/">javascript异步，消息队列和事件循环</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/11/10/json-server/">json数据模拟</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/08/20/imbalanced_data_analysis/">imblearn API</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/08/10/decision-tree-visualization/">tip:决策树、随机森林结果可视化</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/08/04/write_log/">如何写日志</a></li><li class="post-list-item"><a class="post-list-link" href="../../../../2019/08/01/boosting/">boosting</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="../../../../." rel="nofollow">MonoShow.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="../../../../js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="../../../../js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="../../../../js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zindex="-2" count="50" src="//lib.baomitu.com/canvas-nest.js/2.0.3/canvas-nest.umd.js"></script><script type="text/javascript" src="../../../../js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="../../../../js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":true},"log":false});</script></body></html>