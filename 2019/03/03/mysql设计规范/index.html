<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Kevin W build this air-castle to collect infos &amp; photos"><title> | MonoShow</title><link rel="stylesheet" type="text/css" href="../../../../css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="../../../../favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="../../../../favicon.ico"><link rel="apple-touch-icon" href="../../../../apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="../../../../apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="../../../../atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">MonoShow</h1><a id="logo" href="../../../../.">MonoShow</a><p class="description">Monologue from kevin</p></div><div id="nav-menu"><a class="current" href="../../../../."><i class="fa fa-home"> 首页</i></a><a href="../../../../archives/"><i class="fa fa-archive"> 归档</i></a><a href="../../../../photo/"><i class="fa fa-camera"> photo</i></a><a href="../../../../about/"><i class="fa fa-user"> 关于我</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title"></h1><div class="post-meta">Mar 3, 2019<script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 8.7k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 30</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="post-content"><p>《mysql设计规范》<br>数据结构设计：逻辑设计 –&gt; 物理设计<br>实际工作中：逻辑设计 + 物理设计<br>物理设计：表名，字段名，字段类型<br>磁盘IO和操作系统类型，对mysql的性能是非常大的<br>一. 数据库命名规范<br>所有的数据库对象名称必须使用小写字母并用下划线表示，因为默认情况下，mysql对大小写敏感，mysql数据库本质上是linux系统下的一个文件，而linux系统是大小写敏感的<br>所有数据库对象名称禁止使用mysql保留关键字<br>数据库对象的命名要能做到见名知意，并且最好不要超过32个字符。太长不方便使用，并且会在传输时增加网络开销<br>临时表必须以tmp_为前缀并以日期为后缀<br>备份表必须以bak_为前缀并以日期为后缀<br>所有存储相同数据的列名和列类型必须一致，比如user表中的id和order表中的user_id<br>二. 数据库基本设计规范<br>所有表必须使用Innodb存储引擎<br>极少数特殊业务需求除外<br>Innodb引擎是5.6之后的默认存储引擎；mysql5.5之前使用Myisam(默认存储引擎)<br>Innodb优点：支持事务，行级锁，更好的恢复性，高并发下性能更好<br>数据库和表的字符集统一使用UTF-8<br>如果要存储一些如表情符号的，还需使用UTF-8的拓展字符集<br>数据库，表，字段字符集一定要统一，统一字符集可以避免由于字符集转换产生的乱码<br>在mysql中UTF-8字符集，汉字占3字节，ASCII码占1字节<br>所有表和字段都需要添加注释<br>从一开始就进行数据字典的维护<br>即数据库说明文档<br>尽量控制单表数据量大小，<br>建议控制在500万以内，虽然500万并不是mysql的数据库限制，但是会给修改表结构，备份，恢复带来很大困难。<br>单表可存储数据量大小取决于存储设置和文件系统<br>想减少单表数据量：历史数据归档(常见于日志表)，分库分表(常见于业务表)，分区表<br>建议不要使用mysql分区表，因为分区表在物理上表现为多个文件，在逻辑上表现为一个表。如果一定要分区，请谨慎选择分区键，跨分区查询效率比查询大数据量的单表查询效率更低<br>建议采物理分表的方式管理大数据，但是对应用程序的开发要求和复杂度更高<br>尽量做到冷热数据分离，减少表的宽度(字段数)<br>减少磁盘IO，保证热数据的内存缓存命中率，更有效的利用缓存，避免读入无用的冷数据<br>这样的话，就要对表的列进行拆分，将经常使用的列放到一个表中，可以避免过多的关联操作，也可以提高查询性能<br>禁止在表中建立预留字段<br>预留字段很难做到见名知义，预留字段无法确定存储的数据类型，后期如果修改字段类型，会对全表锁定，严重影响数据库的并发性<br>对目前mysql来说，修改一个字段的成本要远远大于增加一个字段的成本<br>禁止在数据库中存储图片，文件等二级制数据<br>这类数据如果要存，就得使用blog或者text这样的大字段加以存储，会影响数据库的性能<br>文件这种通常所占数据容量很大，会在短时间内造成数据库文件的快速增长，而数据库在读取数据时，会进行大量的随机IO操作，如果数据文件过大，IO操作会非常耗时，从而影响数据库性能<br>正确做法是将这类数据存储在文件服务器中，而数据库只村存储地址信息<br>禁止在线上做数据库压力测试<br>会对正常业务造成影响，也会产生很多垃圾数据<br>建议建立专门的压力测试数据库，进行测试，然后对比测试服务器和线上服务器的硬件环境，评估线上数据库的性能<br>禁止从开发环境，测试环境直连生产环境数据库<br>三. 索引设计规范(Innodb中主键实质上是一个索引)<br>限制每张表上索引数量，建议单表不超过5个索引。索引并不是越多越好，可以提高查询效率，但是会降低插入和更新的效率。甚至在一些情况下，还会降低查询效率，因为mysql优化器在选择如何优化查询时，会根据统计信息，对每一个可用索引来进行评估，以生成一个最好的执行计划，如果同时有很多索引都可以用于查询，就会增加mysql查询优化器生成查询计划的时间。<br>每个Innodb表都必须有一个主键。Innodb是一种索引索引组织表，是指数据存储的逻辑顺序和索引的顺序是相同，Innodb是按照主键索引的顺序来组织表的，因此，每个Innodb表都必须要有一个主键，如果我们没有指定主键，那么Innodb会优先选择表中第一个非空唯一索引来作为主键，如果没有这个索引，那么Innodb会自动生成一个占6字节的主键，而这个主键的性能并不是最好。<br>不使用更新频繁的列作为主键，不使用多列联合主键。因为Innodb是一种索引索引组织表，如果主键上的值频繁更新，就意味着数据存储的逻辑顺序频繁变动，必然会带来大量的IO操作，降低数据库性能。<br>不要使用uuid，md5，hash，字符串列作为主键。因为这种主键不能保证主键的值是顺序增长的，如果后来的主键值在已有主键值的中间段，那么这个主键插入的时候，会将所有主键值大于它的列都向后移。<br>最好选择能保证值的顺序为顺序增长的列为主键。并且数据不能重复，建议用mysql自增id建立主键<br>面试问题1: 要在哪些列上建立索引?<br>在select，delete，update的where从句中的列<br>包含在order by，group by，distinct字段中的列<br>多表join的关联列：mysql对关联操作的处理方式只有一种，那就是嵌套循环的关联方式，所以这种操作的性能对关联列上的索引的依赖性很大<br>面试问题2: 复合索引，如何选择索引列的顺序?<br>从左到右的顺序来使用的<br>区分度(列中group by的数目和此列总行数的比值趋近于1)最高的列放在联合索引的最左侧<br>在区分度差不多的情况下，尽量吧字段长度小的放在联合索引的最左侧，因为同样的行数，字段小的文件也小，读取时IO性能更优<br>使用最频繁的列放在联合索引的左侧，这样的话，可以较少地建立索引就能满足需求<br>避免建立冗余索引和重复索引<br>对于频繁的查询优先使用覆盖索引<br>就是包含了所有查询字段的索引，这样可以避免Innodb表进行索引的二次查找，并可以把随机IO变为顺序IO提高查询效率<br>尽量避免使用外键<br>mysql和别的数据库不同，会自动在外键上建立索引，会降低数据库的写性能<br>建议不使用外键约束，但是一定要在表与表之间的关联键上建立索引，虽然外键是为了保证数据的完整性，但是最好在代码中去保证。<br>四. 字段设计规范<br>优先选择符合存储需要的最小的数据类型<br>尽量将字符串转化为数字类型存储：如将ip存储为数字：inet_aton(‘255.255.255.255’) = 4294967295 ,反之， inet_ntoa(4294967295) = ‘255.255.255.255’<br>对于非负整型数据，优先使用无符号整型来存储，如：id,age,无符号相对于有符号，可以多出一倍的存储空间<br>mysql中，varchar(n)中n表示字符数而不是字节数<br>避免使用text，blog来存储字段，这种类型只能使用前缀索引，如果非要使用，建议将这种数据分离到单独的拓展表中<br>避免使用enum类型。枚举本身是一个字符串类型，但是内部确是用正数类型来存储的，所以最多可存储65535种不同的值，修改的话必须使用alter语句，直接修改元数据，有操作风险；order by效率低，必须转换并无法使用索引，禁止使用数值作为enum值，因为enum本身是索引顺序存储的，会造成逻辑混淆<br>尽可能把所有列定义为not null。<br>索引null列需要额外的空间来保存，占更多空间<br>进行比较和计算时，对null值作特别的处理，可能造成索引失效<br>禁止使用字符串来存储日期型数据。<br>无法使用日期函数计算比较<br>字符串存储要占更多的内存空间，datetime(8字节)和timestamp(本身是以int存储，占4字节,范围:1970-01-01 00:00:01到2038-01-19 03:14:07)<br>财务相关数据，使用decimal类型 (精准浮点类型，在计算时不丢失精度)。<br>五. SQL开发规范<br>建议使用预编译语句(prepareStatment)进行数据库操作<br>可以同步执行预编译计划，减少预编译时间<br>可以有效避免动态sql带来的SQL注入的问题<br>只传参数，一次解析，多次使用，比传递sql语句更高效<br>避免数据类型的隐式转换<br>一般出现在where从句中，会导致索引失效，如：select id,name from user where id = ‘12’;<br>充分利用已存在的索引<br>避免使用双%的查询条件，不走索引<br>一个SQL只能利用到复合索引中的一列进行范围查询<br>使用left join或not exists来优化not in操作<br>程序连接不同的数据库使用不同的账号，禁止跨库查询<br>为数据库迁移和分库分表留出余地<br>降低业务耦合度<br>避免权限过大而产生的安全风险<br>禁止使用select * 来查询，必须用字段名<br>可能会消耗更多的cpu和IO以及网络资源<br>无法使用覆盖索引<br>可以减少表结构变更对已有程序的影响<br>禁止使用不含字段列表的insert语句。<br>可以减少表结构变更对已有程序的影响<br>禁止使用子查询<br>虽然可使sql可读性好，但是缺点远远大于优点<br>子查询返回的结果集无法使用索引，结果集会被存储到一个临时表中，结果集越大性能越低<br>把子查询优化为join操作，但是并不是所有的都可以优化为join，一般情况下，只有当子查询是在in字句中，并且子查询是一个简单的sql(不包含union，group by，order by，limit)才能转换为关联查询<br>避免join过多的表<br>每join一个表会占一部分内存(join_buffer_size)<br>会产生临时表操作，影响查询效率<br>mysql最多允许关联61个表，建议不超过5个<br>减少同数据库的交互次数<br>数据库更适合处理批量操作<br>合并多个相同的操作到一起，提高处理效率<br>使用in代替or<br>in的值不要超过500个<br>in 操作可以有效利用索引<br>禁止使用order by rand()进行随机排序<br>会把表中所有符合条件的数据装载到内存中进行排序<br>会消耗大量的cpu和io及内存资源<br>推荐在程序中获取随机值<br>禁止在where从句中对列进行函数转换和计算<br>导致无法使用相关列上的索引<br>where date(create_time)=’20170901’ 写成 where create_time &gt;= ‘20170901’ and create_time &lt; ‘20170902’<br>在明显不会有重复值时使用union all而不是union<br>union 会把所有数据放在临时表中后再进行去重操作，会多消耗内存，IO，网络资源<br>union all 不会再对结果集进行去重操作<br>拆分复杂的大sql为多个小sql<br>目前mysql中一个sql只能使用一个cpu计算，不支持多cpu并行计算<br>sql拆分后可以通过并行执行来提高处理效率<br>六. 数据库操作行为规范<br>主要面向手动操作数据库的行为<br>超过100万的批量写操作，要分批多次进行操作<br>主从复制中：大批量操作可能会造成严重的主从延迟，因为当主库执行完成后，才会在从库执行<br>binlog日志为row格式时会产生大量的日志<br>避免产生大量事务，产生阻塞，占满可用连接<br>对大表数据结构的修改一定要谨慎<br>可能会造成严重的锁表操作，尤其是生产环境，是不能忍受的<br>对于大表使用pt-online-schema-change修改表结构：<br>首先会建立一个与原表结构相同的新表<br>然后在新表上进行表结构的修改<br>然后把原表中的数据复制到新表中，并且增加一些触发器，以便把原表中即时新增的数据也复制到新表中<br>在行的所有数据复制完成之后，会在原表上增加一个很准的时间锁，同时把新表命名为原表，把原表删掉<br>[实际上是把一个原子的DDL操作分解成多批次进行]<br>[避免大表修改产生的主从延迟问题]<br>[避免在对表字段进行修改时进行锁表]<br>禁止为程序使用的账号赋予super权限<br>当数据库连接数达到最大限制时，允许1个有super权限的用户连接<br>super权限只能留给DBA处理问题的账号使用<br>对于程序连接数据库账号，遵循权限最小原则<br>程序使用的数据库账号只能在一个DB下使用，不准跨库</p>
<h2 id="程序使用的账号原则上不准有drop权限"><a href="#程序使用的账号原则上不准有drop权限" class="headerlink" title="程序使用的账号原则上不准有drop权限"></a>程序使用的账号原则上不准有drop权限</h2><p>作者：三呆子<br>来源：CSDN<br>原文：<a href="https://blog.csdn.net/xu_san_duo/article/details/78832884" target="_blank" rel="noopener">https://blog.csdn.net/xu_san_duo/article/details/78832884</a><br>版权声明：本文为博主原创文章，转载请附上博文链接！</p>
<p>MYSQL数据库设计规范</p>
<pre><code>1、数据库命名规范
    采用26个英文字母(区分大小写)和0-9的自然数(经常不需要)加上下划线&apos;_&apos;组成;
    命名简洁明确(长度不能超过30个字符);
    例如：user, stat, log, 也可以wifi_user, wifi_stat, wifi_log给数据库加个前缀;
    除非是备份数据库可以加0-9的自然数：user_db_20151210;

2、数据库表名命名规范
    采用26个英文字母(区分大小写)和0-9的自然数(经常不需要)加上下划线&apos;_&apos;组成;
    命名简洁明确,多个单词用下划线&apos;_&apos;分隔;
    例如：user_login, user_profile, user_detail, user_role, user_role_relation,
        user_role_right, user_role_right_relation
    表前缀&apos;user_&apos;可以有效的把相同关系的表显示在一起;

3、数据库表字段名命名规范
    采用26个英文字母(区分大小写)和0-9的自然数(经常不需要)加上下划线&apos;_&apos;组成;
    命名简洁明确,多个单词用下划线&apos;_&apos;分隔;
    例如：user_login表字段 user_id, user_name, pass_word, eamil, tickit, status, mobile, add_time;
    每个表中必须有自增主键,add_time(默认系统时间)
    表与表之间的相关联字段名称要求尽可能的相同;

4、数据库表字段类型规范
    用尽量少的存储空间来存数一个字段的数据;
    例如：能使用int就不要使用varchar、char,能用varchar(16)就不要使用varchar(256);
    IP地址最好使用int类型;
    固定长度的类型最好使用char,例如：邮编;
    能使用tinyint就不要使用smallint,int;
    最好给每个字段一个默认值,最好不能为null;

5、数据库表索引规范
    命名简洁明确,例如：user_login表user_name字段的索引应为user_name_index唯一索引;
    为每个表创建一个主键索引;
    为每个表创建合理的索引;
    建立复合索引请慎重;

6、简单熟悉数据库范式
    第一范式(1NF)：字段值具有原子性,不能再分(所有关系型数据库系统都满足第一范式);
        例如：姓名字段,其中姓和名是一个整体,如果区分姓和名那么必须设立两个独立字段;

    第二范式(2NF)：一个表必须有主键,即每行数据都能被唯一的区分;
        备注：必须先满足第一范式;

    第三范式(3NF)：一个表中不能包涵其他相关表中非关键字段的信息,即数据表不能有沉余字段;
        备注：必须先满足第二范式;

    备注：往往我们在设计表中不能遵守第三范式,因为合理的沉余字段将会给我们减少join的查询;
          例如：相册表中会添加图片的点击数字段,在相册图片表中也会添加图片的点击数字段;
</code></pre><p>MYSQL数据库设计原则</p>
<pre><code>1、核心原则
    不在数据库做运算;
    cpu计算务必移至业务层;
    控制列数量(字段少而精,字段数建议在20以内);
    平衡范式与冗余(效率优先；往往牺牲范式)
    拒绝3B(拒绝大sql语句：big sql、拒绝大事物：big transaction、拒绝大批量：big batch);

2、字段类原则
    用好数值类型(用合适的字段类型节约空间);
    字符转化为数字(能转化的最好转化,同样节约空间、提高查询性能);
    避免使用NULL字段(NULL字段很难查询优化、NULL字段的索引需要额外空间、NULL字段的复合索引无效);
    少用text类型(尽量使用varchar代替text字段);

3、索引类原则
    合理使用索引(改善查询,减慢更新,索引一定不是越多越好);
    字符字段必须建前缀索引;
    不在索引做列运算;
    innodb主键推荐使用自增列(主键建立聚簇索引,主键不应该被修改,字符串不应该做主键)(理解Innodb的索引保存结构就知道了);
    不用外键(由程序保证约束);

4、sql类原则
    sql语句尽可能简单(一条sql只能在一个cpu运算,大语句拆小语句,减少锁时间,一条大sql可以堵死整个库);
    简单的事务;
    避免使用trig/func(触发器、函数不用客户端程序取而代之);
    不用select *(消耗cpu,io,内存,带宽,这种程序不具有扩展性);
    OR改写为IN(or的效率是n级别);
    OR改写为UNION(mysql的索引合并很弱智);
        select id from t where phone = ’159′ or name = ‘john’;
        =&gt;
        select id from t where phone=’159′
        union
        select id from t where name=’jonh’
    避免负向%;
    慎用count(*);
    limit高效分页(limit越大，效率越低);
    使用union all替代union(union有去重开销);
    少用连接join;
    使用group by;
    请使用同类型比较;
    打散批量更新;

5、性能分析工具
    show profile;
    mysqlsla;
    mysqldumpslow;
    explain;
    show slow log;
    show processlist;
</code></pre><p>数据库设计14个技巧 </p>
<ol>
<li>原始单据与实体之间的关系<br>　　可以是一对一、一对多、多对多的关系。在一般情况下，它们是一对一的关系：即一张原始单据对应且只对应一个实体。<br>在特殊情况下，它们可能是一对多或多对一的关系，即一张原始单证对应多个实体，或多张原始单证对应一个实体。<br>这里的实体可以理解为基本表。明确这种对应关系后，对我们设计录入界面大有好处。 </li>
</ol>
<p>　　〖例1〗：一份员工履历资料，在人力资源信息系统中，就对应三个基本表：员工基本情况表、社会关系表、工作简历表。<br>　　　　　　  这就是“一张原始单证对应多个实体”的典型例子。 </p>
<ol start="2">
<li>主键与外键<br>　　一般而言，一个实体不能既无主键又无外键。在E—R 图中, 处于叶子部位的实体, 可以定义主键，也可以不定义主键<br>　　(因为它无子孙), 但必须要有外键(因为它有父亲)。 </li>
</ol>
<p>　　主键与外键的设计，在全局数据库的设计中，占有重要地位。当全局数据库的设计完成以后，有个美国数据库设计专<br>　　家说：“键，到处都是键，除了键之外，什么也没有”，这就是他的数据库设计经验之谈，也反映了他对信息系统核<br>　　心(数据模型)的高度抽象思想。因为：主键是实体的高度抽象，主键与外键的配对，表示实体之间的连接。 </p>
<ol start="3">
<li><p>基本表的性质<br>　　基本表与中间表、临时表不同，因为它具有如下四个特性：<br>　　 (1) 原子性。基本表中的字段是不可再分解的。<br>　　 (2) 原始性。基本表中的记录是原始数据（基础数据）的记录。<br>　　 (3) 演绎性。由基本表与代码表中的数据，可以派生出所有的输出数据。<br>　　 (4) 稳定性。基本表的结构是相对稳定的，表中的记录是要长期保存的。<br>　　理解基本表的性质后，在设计数据库时，就能将基本表与中间表、临时表区分开来。 </p>
</li>
<li><p>范式标准<br>　　基本表及其字段之间的关系, 应尽量满足第三范式。但是，满足第三范式的数据库设计，往往不是最好的设计。<br>　　为了提高数据库的运行效率，常常需要降低范式标准：适当增加冗余，达到以空间换时间的目的。 </p>
</li>
</ol>
<p>　　〖例2〗：有一张存放商品的基本表，如表1所示。“金额”这个字段的存在，表明该表的设计不满足第三范式，<br>　　因为“金额”可以由“单价”乘以“数量”得到，说明“金额”是冗余字段。但是，增加“金额”这个冗余字段，<br>　　可以提高查询统计的速度，这就是以空间换时间的作法。<br>　　在Rose 2002中，规定列有两种类型：数据列和计算列。“金额”这样的列被称为“计算列”，而“单价”和<br>　　“数量”这样的列被称为“数据列”。 </p>
<p>　　表1 商品表的表结构<br>　　商品名称 商品型号 单价 数量 金额<br>　　电视机 29吋 2,500 40 100,000 
　　 </p>
<ol start="5">
<li>通俗地理解三个范式<br>　　通俗地理解三个范式，对于数据库设计大有好处。在数据库设计中，为了更好地应用三个范式，就必须通俗地理解<br>　　三个范式(通俗地理解是够用的理解，并不是最科学最准确的理解)：<br>　　第一范式：1NF是对属性的原子性约束，要求属性具有原子性，不可再分解；<br>　　第二范式：2NF是对记录的惟一性约束，要求记录有惟一标识，即实体的惟一性；<br>　　第三范式：3NF是对字段冗余性的约束，即任何字段不能由其他字段派生出来，它要求字段没有冗余。 </li>
</ol>
<p>　　没有冗余的数据库设计可以做到。但是，没有冗余的数据库未必是最好的数据库，有时为了提高运行效率，就必须降<br>　　低范式标准，适当保留冗余数据。具体做法是：在概念数据模型设计时遵守第三范式，降低范式标准的工作放到物理<br>　　数据模型设计时考虑。降低范式就是增加字段，允许冗余。 </p>
<ol start="6">
<li>要善于识别与正确处理多对多的关系<br>　　若两个实体之间存在多对多的关系，则应消除这种关系。消除的办法是，在两者之间增加第三个实体。这样，原来一<br>　　个多对多的关系，现在变为两个一对多的关系。要将原来两个实体的属性合理地分配到三个实体中去。这里的第三个<br>　　实体，实质上是一个较复杂的关系，它对应一张基本表。一般来讲，数据库设计工具不能识别多对多的关系，但能处<br>　　理多对多的关系。 </li>
</ol>
<p>　　〖例3〗：在“图书馆信息系统”中，“图书”是一个实体，“读者”也是一个实体。这两个实体之间的关系，是一<br>　　个典型的多对多关系：一本图书在不同时间可以被多个读者借阅，一个读者又可以借多本图书。为此，要在二者之<br>　　间增加第三个实体，该实体取名为“借还书”，它的属性为：借还时间、借还标志(0表示借书，1表示还书)，另外，<br>　　它还应该有两个外键(“图书”的主键，“读者”的主键)，使它能与“图书”和“读者”连接。 </p>
<ol start="7">
<li><p>主键PK的取值方法<br>　　 PK是供程序员使用的表间连接工具，可以是一无物理意义的数字串, 由程序自动加1来实现。也可以是有物理意义<br>　　的字段名或字段名的组合。不过前者比后者好。当PK是字段名的组合时，建议字段的个数不要太多，多了不但索引<br>　　占用空间大，而且速度也慢。 </p>
</li>
<li><p>正确认识数据冗余<br>　　主键与外键在多表中的重复出现, 不属于数据冗余，这个概念必须清楚，事实上有许多人还不清楚。非键字段的重<br>　　复出现, 才是数据冗余！而且是一种低级冗余，即重复性的冗余。高级冗余不是字段的重复出现，而是字段的派生出现。 </p>
</li>
</ol>
<p>　　〖例4〗：商品中的“单价、数量、金额”三个字段，“金额”就是由“单价”乘以“数量”派生出来的，它就是冗余，<br>　　而且是一种高级冗余。冗余的目的是为了提高处理速度。只有低级冗余才会增加数据的不一致性，因为同一数据，可<br>　　能从不同时间、地点、角色上多次录入。因此，我们提倡高级冗余(派生性冗余)，反对低级冗余(重复性冗余)。 </p>
<ol start="9">
<li>E–R图没有标准答案<br>　　信息系统的E–R图没有标准答案，因为它的设计与画法不是惟一的，只要它覆盖了系统需求的业务范围和功能内容，<br>　　就是可行的。反之要修改E–R图。尽管它没有惟一的标准答案，并不意味着可以随意设计。好的E—R图的标准是：<br>　　结构清晰、关联简洁、实体个数适中、属性分配合理、没有低级冗余。 </li>
</ol>
<p>10 . 视图技术在数据库设计中很有用<br>　　与基本表、代码表、中间表不同，视图是一种虚表，它依赖数据源的实表而存在。视图是供程序员使用数据库的<br>　　一个窗口，是基表数据综合的一种形式, 是数据处理的一种方法，是用户数据保密的一种手段。为了进行复杂处理、<br>　　提高运算速度和节省存储空间, 视图的定义深度一般不得超过三层。 若三层视图仍不够用, 则应在视图上定义临时表,<br>　　 在临时表上再定义视图。这样反复交迭定义, 视图的深度就不受限制了。 </p>
<p>　　对于某些与国家政治、经济、技术、军事和安全利益有关的信息系统，视图的作用更加重要。这些系统的基本表完<br>　　成物理设计之后，立即在基本表上建立第一层视图，这层视图的个数和结构，与基本表的个数和结构是完全相同。<br>　　并且规定，所有的程序员，一律只准在视图上操作。只有数据库管理员，带着多个人员共同掌握的“安全钥匙”，<br>　　才能直接在基本表上操作。请读者想想：这是为什么？ </p>
<ol start="11">
<li><p>中间表、报表和临时表<br>　　中间表是存放统计数据的表，它是为数据仓库、输出报表或查询结果而设计的，有时它没有主键与外键(数据仓<br>　　库除外)。临时表是程序员个人设计的，存放临时记录，为个人所用。基表和中间表由DBA维护，临时表由程序员<br>　　自己用程序自动维护。 </p>
</li>
<li><p>完整性约束表现在三个方面<br>　　域的完整性：用Check来实现约束，在数据库设计工具中，对字段的取值范围进行定义时，有一个Check按钮，通<br>　　过它定义字段的值城。<br>　　参照完整性：用PK、FK、表级触发器来实现。<br>　　用户定义完整性：它是一些业务规则，用存储过程和触发器来实现。 </p>
</li>
<li><p>防止数据库设计打补丁的方法是“三少原则”<br>　　 (1) 一个数据库中表的个数越少越好。只有表的个数少了，才能说明系统的E–R图少而精，去掉了重复的多余的<br>　　　　实体，形成了对客观世界的高度抽象，进行了系统的数据集成，防止了打补丁式的设计； </p>
</li>
</ol>
<p>　　 (2) 一个表中组合主键的字段个数越少越好。因为主键的作用，一是建主键索引，二是做为子表的外键，所以组<br>　　　　合主键的字段个数少了，不仅节省了运行时间，而且节省了索引存储空间； </p>
<p>　　 (3) 一个表中的字段个数越少越好。只有字段的个数少了，才能说明在系统中不存在数据重复，且很少有数据冗<br>　　　　余，更重要的是督促读者学会“列变行”，这样就防止了将子表中的字段拉入到主表中去，在主表中留下许<br>　　　　多空余的字段。所谓“列变行”，就是将主表中的一部分内容拉出去，另外单独建一个子表。这个方法很简<br>　　　　单，有的人就是不习惯、不采纳、不执行。 </p>
<p>　　数据库设计的实用原则是：在数据冗余和处理速度之间找到合适的平衡点。“三少”是一个整体概念，综合观点，<br>　　不能孤立某一个原则。该原则是相对的，不是绝对的。“三多”原则肯定是错误的。试想：若覆盖系统同样的功<br>　　能，一百个实体(共一千个属性) 的E–R图，肯定比二百个实体(共二千个属性) 的E–R图，要好得多。 </p>
<p>　　提倡“三少”原则，是叫读者学会利用数据库设计技术进行系统的数据集成。数据集成的步骤是将文件系统集成<br>　　为应用数据库，将应用数据库集成为主题数据库，将主题数据库集成为全局综合数据库。集成的程度越高，数据<br>　　共享性就越强，信息孤岛现象就越少，整个企业信息系统的全局E—R图中实体的个数、主键的个数、属性的个数<br>　　就会越少。 </p>
<p>　　提倡“三少”原则的目的，是防止读者利用打补丁技术，不断地对数据库进行增删改，使企业数据库变成了随意<br>　　设计数据库表的“垃圾堆”，或数据库表的“大杂院”，最后造成数据库中的基本表、代码表、中间表、临时表<br>　　杂乱无章，不计其数，导致企事业单位的信息系统无法维护而瘫痪。 </p>
<p>　　 “三多”原则任何人都可以做到，该原则是“打补丁方法”设计数据库的歪理学说。“三少”原则是少而精的<br>　　原则，它要求有较高的数据库设计技巧与艺术，不是任何人都能做到的，因为该原则是杜绝用“打补丁方法”<br>　　设计数据库的理论依据。 </p>
<ol start="14">
<li>提高数据库运行效率的办法<br>　　在给定的系统硬件和系统软件条件下，提高数据库系统的运行效率的办法是：<br>　　 (1) 在数据库物理设计时，降低范式，增加冗余, 少用触发器, 多用存储过程。<br>　　 (2) 当计算非常复杂、而且记录条数非常巨大时(例如一千万条)，复杂计算要先在数据库外面，以文件系统方<br>　　　　式用C++语言计算处理完成之后，最后才入库追加到表中去。这是电信计费系统设计的经验。<br>　　 (3) 发现某个表的记录太多，例如超过一千万条，则要对该表进行水平分割。水平分割的做法是，以该表主键<br>　　　　PK的某个值为界线，将该表的记录水平分割为两个表。若发现某个表的字段太多，例如超过八十个，则<br>　　　　垂直分割该表，将原来的一个表分解为两个表。<br>　　 (4) 对数据库管理系统DBMS进行系统优化，即优化各种系统参数，如缓冲区个数。<br>　　 (5) 在使用面向数据的SQL语言进行程序设计时，尽量采取优化算法。<br>　　　　总之，要提高数据库的运行效率，必须从数据库系统级优化、数据库设计级优化、程序实现级优化，这三<br>　　　　个层次上同时下功夫。 </li>
</ol>
<p>　　上述十四个技巧，是许多人在大量的数据库分析与设计实践中，逐步总结出来的。对于这些经验的运用，读者<br>　　不能生帮硬套，死记硬背，而要消化理解，实事求是，灵活掌握。并逐步做到：在应用中发展，在发展中应用。</p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>KevinW</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2019/03/03/mysql设计规范/">https://hyqskevin.github.io/2019/03/03/mysql设计规范/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！</li></ul></div><br><div class="tags"></div><div class="post-nav"><a class="next" href="../php-notes3/">PHP &amp; MySQL learning notes (4)</a></div></div></div></div><div class="pure-u-1 pure-u-md-1-4"><div id="sidebar"><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="../../../../categories/Adobe/">Adobe</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/notes/">notes</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/others/">others</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/practice/">practice</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/repo/">repo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="../../../../categories/study/">study</a><span class="category-list-count">11</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="../../../../tags/bootstrap2-0/" style="font-size: 15px;">bootstrap2.0</a> <a href="../../../../tags/others/" style="font-size: 15px;">others</a> <a href="../../../../tags/Kaggle/" style="font-size: 15px;">Kaggle</a> <a href="../../../../tags/hexo/" style="font-size: 15px;">hexo</a> <a href="../../../../tags/time-series/" style="font-size: 15px;">time_series</a> <a href="../../../../tags/ensemble-learning/" style="font-size: 15px;">ensemble_learning</a> <a href="../../../../tags/bp-nn/" style="font-size: 15px;">bp_nn</a> <a href="../../../../tags/book/" style="font-size: 15px;">book</a> <a href="../../../../tags/php/" style="font-size: 15px;">php</a> <a href="../../../../tags/mysql/" style="font-size: 15px;">mysql</a> <a href="../../../../tags/slam/" style="font-size: 15px;">slam</a> <a href="../../../../tags/Linux-device/" style="font-size: 15px;">Linux_device</a> <a href="../../../../tags/laravel/" style="font-size: 15px;">laravel</a> <a href="../../../../tags/machine-learning/" style="font-size: 15px;">machine_learning</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="">mysql设计规范</a></li><li class="post-list-item"><a class="post-list-link" href="../php-notes3/">PHP & MySQL learning notes (4)</a></li><li class="post-list-item"><a class="post-list-link" href="../mysql-function/">mysql_function</a></li><li class="post-list-item"><a class="post-list-link" href="../../../02/27/migration/">Laravel SQL migration</a></li><li class="post-list-item"><a class="post-list-link" href="../../../02/23/mysql-regular/">mysql like子句和正则表达式匹配</a></li><li class="post-list-item"><a class="post-list-link" href="../../../02/20/fund-flow/">fund_flow</a></li><li class="post-list-item"><a class="post-list-link" href="../../../02/16/book-list/">book-list</a></li><li class="post-list-item"><a class="post-list-link" href="../../../02/15/mysql/">mysql 学习笔记</a></li><li class="post-list-item"><a class="post-list-link" href="../../../02/14/move-to-windows/">move to windows</a></li><li class="post-list-item"><a class="post-list-link" href="../../../01/21/php-notes2/">PHP & MySQL learning notes (3)</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="../../../../." rel="nofollow">MonoShow.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="../../../../js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="../../../../js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="../../../../js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zindex="-2" count="50" src="//lib.baomitu.com/canvas-nest.js/2.0.3/canvas-nest.umd.js"></script><script type="text/javascript" src="../../../../js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="../../../../js/smartresize.js?v=0.0.0"></script></div><script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/haruto.model.json"},"display":{"position":"left","width":100,"height":200},"mobile":{"show":true},"log":false});</script></body></html>